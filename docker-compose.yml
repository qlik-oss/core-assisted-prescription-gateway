version: "3.1"

services:
  openresty:
    build: .
    environment:
      SESSION_COOKIE_NAME: custom-analytics
      KIBANA_HOST: kibana
      KIBANA_PORT: 5601
      VISUALIZER_HOST: viz
      VISUALIZER_PORT: 8080
      QIX_SESSION_HOST: qix-session
      QIX_SESSION_PORT: 9455
      AUTH_HOST: auth
      AUTH_PORT: 3000
      CERT_FILE: /run/secrets/cert-gateway.crt
      CERT_KEY: /run/secrets/cert-gateway.key
    networks:
      - qliktivecustomanalytics_default
    ports:
      - "80:80"
      - "443:443"

networks:
  qliktivecustomanalytics_default:
    external: true