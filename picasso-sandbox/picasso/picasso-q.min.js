/**
 * @qlik/picasso-q v0.33.0
 * Copyright (c) 2017 QlikTech International AB
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.picassoQ=t()}(this,function(){"use strict";function e(e){var t=0,r=e.children,n=r&&r.length;if(n)for(;--n>=0;)t+=r[n].value;else t=1;e.value=t}function t(e,t){if(e===t)return e;var r=e.ancestors(),n=t.ancestors(),i=null;for(e=r.pop(),t=n.pop();e===t;)i=e,e=r.pop(),t=n.pop();return i}function r(e,t){var r,i,u,s,f,l=new o(e),c=+e.value&&(l.value=e.value),p=[l];for(null==t&&(t=n);r=p.pop();)if(c&&(r.value=+r.data.value),(u=t(r.data))&&(f=u.length))for(r.children=new Array(f),s=f-1;s>=0;--s)p.push(i=r.children[s]=new o(u[s])),i.parent=r,i.depth=r.depth+1;return l.eachBefore(a)}function n(e){return e.children}function i(e){e.data=e.data.data}function a(e){var t=0;do{e.height=t}while((e=e.parent)&&e.height<++t)}function o(e){this.data=e,this.depth=this.height=0,this.parent=null}function u(e,t){"/"===e.charAt(0)&&(e=e.substring(1));for(var r=e.split("/"),n=void 0,i=t,a=0;a<r.length;a++){if("*"===r[a]&&Array.isArray(i)){var o=[];n=r.slice(a+1).join("/");for(var s=0;s<i.length;s++){var f=u(n,i[s]);Array.isArray(f)?o.push.apply(o,Z(f)):o.push(f)}return o}if(!r[a]&&Array.isArray(i)){var l=new Array(i.length);n=r.slice(a+1).join("/");for(var c=0;c<i.length;c++)l[c]=u(n,i[c]);return l}r[a]in i&&(i=i[r[a]])}return i}function s(e,t){var r=e,n=t.qDimensionInfo.length,i=t.qMeasureInfo.length,a=t.qEffectiveInterColumnSortOrder;r<n&&a?r=a.indexOf(r):r>=n&&a&&i>1&&-1!==a.indexOf(-1)&&(r=a.indexOf(-1));for(var o="/qData/*/qSubNodes",u=Math.max(0,Math.min(r,n)),s=0;s<u;s++)o+="/*/qSubNodes";if(e>=n)if(i>1)for(o+="/"+(e-n)+"/qSubNodes",++s;s<=n;s++)o+="/*/qSubNodes";else o+="/"+(e-n);return o}function f(e,t,r){return"number"==typeof t?e+"/*/qAttrExps/qValues/"+t:"number"==typeof r?e+"/*/qAttrDims/qValues/"+r:e}function l(e,t){var r=t.cache,n=t.cube;if(!e)return"";var i=r.fields.indexOf(e),a=void 0,o=void 0;if(-1===i)for(var u=0;u<r.attributeDimensionFields.length;u++)if(-1!==(o=r.attributeDimensionFields[u]?r.attributeDimensionFields[u].indexOf(e):-1)){i=u;break}if(-1===i)for(var l=0;l<r.attributeExpressionFields.length;l++)if(-1!==(a=r.attributeExpressionFields[l]?r.attributeExpressionFields[l].indexOf(e):-1)){i=l;break}return f(s(i,n),a>=0?a:void 0,o>=0?o:void 0)}function c(e,t){return l(e,{cache:t.cache,cube:t.cube}).replace(/qSubNodes/g,"children").replace(/children$/g,"children/*").replace(/qData\/\*/,"")}function p(e,t,n,i){var a="/qStackedDataPages/*/qData",o=t.raw(),s=u(a,o);if(!s||!s[0])return null;for(var f=r(s[0],e.children||function(e){return e.qSubNodes}),l=f.height,p=[],d=0;d<=l;d++)!function(r){var u=i.normalizeConfig(e,t),s=u.props,f=u.main,l=Object.keys(s);p[r]={propsArr:l,props:s,main:f};var d=null,h=0===r;if(r>0){var v=o.qEffectiveInterColumnSortOrder[r-1];r>o.qEffectiveInterColumnSortOrder.length&&(v=o.qDimensionInfo.length),d=n.fields[v]}var m=d?c(d,{cube:o,cache:n}):a;l.forEach(function(e){var t=s[e];if(t.field){var r=c(t.field,{cube:o,cache:n});if(r===m)t.isSame=!0;else if(h)t.isDescendant=!0,t.path=r+"/data";else{var i=r.match(/\//g).length>m.match(/\//g).length,a="";a=i?r.replace(m,"").replace(/^\/\*/,"")+"/data":Math.ceil((m.match(/\//g).length-r.match(/\//g).length)/2),t.isDescendant=i,t.path=a}}})}(d);var h=[],v=0;return f.each(function(e){var t=h[v++]=e.data,r=p[e.depth].propsArr,n=p[e.depth].props,i=p[e.depth].main;e.data={value:"function"==typeof i.value?i.value(t):t},r.forEach(function(r){var i=n[r],a=function(e){return e},o=void 0;if("primitive"===i.type)o=i.value;else if("function"==typeof i.value&&(a=function(e){return i.value(e)}),i.field){if(i.isSame)o=t;else if(i.isDescendant)o=u(i.path,e),Array.isArray(o)&&(o=o.map(a),a=i.reduce||function(e){return e.join(", ")});else if(i.path){for(var s=i.path||0,f=e,l=0;l<s;l++)f=f.parent;o=f.data.value}}else o=t;e.data[r]={value:a(o)},i.source&&(e.data[r].source={field:i.source})})}),f}function d(e,t,r,n){var i=[];if(t<=0){var a=n>=0?[e[n]]:e;r?i.push.apply(i,Z(a.map(function(e){return e[r]}))):i.push.apply(i,Z(a))}else for(var o=0;o<e.length;o++)e[o].children&&e[o].children.length&&i.push.apply(i,Z(d(e[o].children,t-1,r,n)));return i}function h(e,t,r,n){if(e===t)return function(e){return e};if(e>t){var i=Math.max(0,Math.min(100,e-t)),a=[].concat(Z(Array(i))).map(String.prototype.valueOf,"parent").join(".");return r?Function("node","return node."+a+"."+r+";"):Function("node","return node."+a+";")}if(t>e){var o=Math.max(0,Math.min(100,t-e));return function(e){return d(e.children,o-1,r,n)}}return!1}function v(e,t){var r=t.cache;if("number"==typeof e)return r.fields[e];var n=r.fields.slice();if((r.attributeDimensionFields||[]).forEach(function(e){return n.push.apply(n,Z(e))}),(r.attributeExpressionFields||[]).forEach(function(e){return n.push.apply(n,Z(e))}),"string"==typeof e){for(var i=0;i<n.length;i++)if(n[i].key()===e||n[i].title()===e)return n[i]}else if(e&&-1!==n.indexOf(e))return e;throw Error("Field not found: "+e)}function m(e,t){var r=t.cube;if(!e)return-1;var n=e.key(),i=!1,a=-1,o=-1,u=-1,s=-1,f=-1,l=void 0;ee.test(n)?(i=!0,a=+ee.exec(n)[1],l=n.replace(ee,"")):te.test(n)&&(f=+te.exec(n)[1],l=n.replace(te,"")),l&&(ne.exec(l)?u=+ne.exec(l)[1]:re.exec(l)&&(o=+re.exec(l)[1]));var c=r.qEffectiveInterColumnSortOrder;return s=i?c?c.indexOf(a):a:c&&-1!==c.indexOf(-1)?c.indexOf(-1):r.qDimensionInfo.length,{fieldDepth:s+1,pseudoMeasureIndex:f,attrDimIdx:u,attrIdx:o}}function y(e,t,r){var n=h(e.fieldDepth,t.fieldDepth,r,t.pseudoMeasureIndex),i=void 0;return t.attrDimIdx>=0?i=function(e){return e.qAttrDims.qValues[t.attrDimIdx]}:t.attrIdx>=0&&(i=function(e){return e.qAttrExps.qValues[t.attrIdx]}),{nodeFn:n,attrFn:i}}function g(e,t,n,i){var a=[];return(Array.isArray(e)?e:[e]).forEach(function(e){if(e.field){var o=t.raw(),s="object"===K(e.field)?e.field:t.field(e.field),f=i.normalizeConfig(e,t),l=f.props,c=f.main,p=Object.keys(l);if(!n.tree){var d=u("/qStackedDataPages/*/qData",o);n.tree=r(d[0],function(e){return e.qSubNodes})}var h=m(s,{cube:o,cache:n}),v=y({fieldDepth:0},h),g=v.nodeFn,b=v.attrFn,q=g(n.tree);p.forEach(function(e){var t=l[e];if(t.field)if(t.field===s)t.isSame=!0;else{var r=m(t.field,{cube:o,cache:n}),i=y(h,r,"data");t.accessor=i.nodeFn,t.attrAccessor=i.attrFn}});var x=q.map(function(e){var t=b?b(e.data):e.data,r={value:"function"==typeof c.value?c.value(t):void 0!==c.value?c.value:t,source:{field:c.field.key()}};return p.forEach(function(n){var i=l[n],a=void 0,o=void 0;"primitive"===i.type?o=i.value:("function"==typeof i.value&&(a=i.value),i.accessor?(o=i.accessor(e),Array.isArray(o)?(i.attrAccessor&&(o=o.map(i.attrAccessor)),a&&(o=o.map(a),a=null),o=i.reduce?i.reduce(o):o):o=i.attrAccessor?i.attrAccessor(o):o):o=t),r[n]={value:a?a(o):o},i.field&&(r[n].source={field:i.field.key()})}),r});a.push.apply(a,Z(x))}}),a}function b(e,t,r){var n=r.cache;if(!e)return-1;var i=n.fields.indexOf(e),a=-1,o=-1;if(-1===i)for(var u=0;u<n.attributeDimensionFields.length;u++)if(-1!==(o=n.attributeDimensionFields[u]?n.attributeDimensionFields[u].indexOf(e):-1)){i=u;break}if(-1===i)for(var s=0;s<n.attributeExpressionFields.length;s++)if(-1!==(a=n.attributeExpressionFields[s]?n.attributeExpressionFields[s].indexOf(e):-1)){i=s;break}if((i-=t.qArea.qLeft)<0||i>=t.qArea.qWidth)return-1;var f="row["+i+"]";return o>=0?Function("row","return "+f+".qAttrDims.qValues["+o+"];"):a>=0?Function("row","return "+f+".qAttrExps.qValues["+a+"];"):Function("row","return "+f+";")}function q(e,t,r){var n=r.key,i={value:"function"==typeof e.value?e.value(t):void 0!==e.value?e.value:t};return e.field&&(i.source={key:n,field:e.field.key()}),i}function x(e,t,r,n){var i=n.normalizeConfig,a=[];return(Array.isArray(e)?e:[e]).forEach(function(e){if(e.field){var n=t.raw(),o=t.key(),u="object"===K(e.field)?e.field:t.field(e.field),s=i(e,t),f=s.props,l=s.main,c=Object.keys(f),p=!!e.trackBy,d=K(e.trackBy),h={},v=[],m=[],y=void 0;n.qDataPages.forEach(function(t){var n=b(u,t,{cache:r});-1!==n&&t.qMatrix.forEach(function(i,a){var s=t.qArea.qTop+a,g=se({qRow:s},n(i)),x=q(l,g,{key:o});if(c.forEach(function(e){var n=f[e],a=g;if(n.field&&n.field!==u){var l=b(n.field,t,{cache:r});if(-1===l)return;a=se({qRow:s},l(i))}x[e]=q(n,a,{key:o},e)}),p){y="function"===d?e.trackBy(g):g[e.trackBy];var M=h[y];M||(M=h[y]={items:[],id:y},v.push(M)),M.items.push(x)}m.push(x)})}),p?a.push.apply(a,Z(v.map(function(e){var t=e.items.map(function(e){return e.value}),r=l.reduce,n={value:r?r(t):t,source:e.items[0].source};return c.forEach(function(t){var r=e.items.map(function(e){return e[t].value}),i=f[t].reduce;n[t]={value:i?i(r):r},e.items[0][t].source&&(n[t].source=e.items[0][t].source)}),n}))):a.push.apply(a,m)}}),a}function M(e){return e.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")}function D(e,t,r,n){return e=e.toString(t),r[1]===r[1].toUpperCase()&&(e=e.toUpperCase()),e.length-e.indexOf(".")>10&&(e=e.slice(0,e.indexOf(".")+11)),e.replace(".",n||".")}function A(e,t){for(var r=void 0,n="",i=Number(String(e).slice(-3)),a=(e-i)/1e3,o=[0,1,4,5,9,10,40,50,90,100,400,500,900].reverse(),u=["0","I","IV","V","IX","X","XL","L","XC","C","CD","D","CM"].reverse();i>0;)for(r=0;r<o.length;r++)if(o[r]<=i){n+=u[r],i-=o[r];break}for(r=0;r<a;r++)n="M"+n;return t[1]!==t[1].toUpperCase()&&(n=n.toLowerCase()),n}function E(e,t,r){var n=void 0;return pe.test(t)?e=D(e,Number(/\d{2}/.exec(t)[0]),t,r):de.test(t)?e=D(e,8,t,r):he.test(t)?e=D(e,10,t,r):ve.test(t)?e=D(e,16,t,r):me.test(t)?e=D(e,2,t,r):ye.test(t)&&(n="",e<0&&(n="-",e=-e),e=0===(e=Math.floor(e))?"0":e<=5e5?n+(e=A(e,t)):t+n+e.toExponential(0)),e}function I(e,t,r){var n=M(e);return r?n:new RegExp(n||"",t)}function C(e,t){return t&&(t=M(t)),e&&(e=M(e)),new RegExp("(?:[#0]+"+e+")?[#0]+(?:"+t+"[#0]+)?")}function F(e,t,r){var n=void 0,i=void 0,a=e.pattern,o=void 0,u=void 0,s=void 0,f=void 0,l=void 0,c=void 0,p=void 0;a.indexOf("A")>=0&&(a=a.replace("A",""),e.abbreviate=!0),p=C(t,r),u=(o=(o=a.match(p))?o[0]:"")?a.substr(0,a.indexOf(o)):a,s=o?a.substring(a.indexOf(o)+o.length):"",o||(o=a?"#":"##########"),t&&t===r&&(i=(n=o.split(r)).pop(),o=n.join("")+r+i,t=""),f=t,t=/,/.test(r)?"¤":",",f&&(o=o.replace(I(f,"g"),t)),l=r,r=".",l&&(o=o.replace(I(l,"g"),r)),c=(c=o.match(/#/g))?c.length:0,e.prefix=u||"",e.postfix=s||"",e.pattern=a,e.percentage=ce.test(a),e.numericPattern=o||"",e.numericRegex=new RegExp(I(t,null,!0)+"|"+I(r,null,!0),"g"),e.groupTemp=f,e.decTemp=l,e.t=t,e.d=r,e.temp=c}function S(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return new(Function.prototype.bind.apply(be,[null].concat(t)))}function N(e,t,r,n,i){function a(e){return o.formatValue(e)}var o=S(i,e,t,r,n);return a.format=function(e,t,r,n){return o.format(t,e,r,n)},a.pattern=function(e){return e&&(o.pattern=e,o.prepare()),o.pattern},a}function w(e,t){for(var r=e.length;r<t;r++)e="0"+e;return e}function O(e,t){var r=e.getHours(),n=e.getDay()-1;return t&&((r%=12)||(r=12)),n<0&&(n=6),{year:e.getFullYear(),month:e.getMonth(),day:n,date:e.getDate(),h:r,m:e.getMinutes(),s:e.getSeconds(),f:e.getMilliseconds(),t:e.getHours()>=12?"pm":"am"}}function k(e){var t=e.toString().split(".");return t[1]?t=Number("0."+t[1]):0}function T(e){var t=e,r=24*k(t),n=60*k(r),i=60*k(n),a=1e3*k(i);return{d:Math.floor(t),h:Math.floor(r),m:Math.floor(n),s:Math.floor(i),f:Math.round(a)}}function H(e,t){var r=T(e),n=r.d,i=r.h,a=r.m,o=r.s,u=r.f,s=0,f=void 0;/w+|t+/gi.test(t)&&(f=new Date(1899,11,30+Math.floor(e),0,0,86400*(e-Math.floor(e))),isNaN(f.getTime())&&(f=null)),/D+/gi.test(t)||(i+=24*n),/h+/gi.test(t)||(a+=60*i),/m+/gi.test(t)||(o+=60*a),/w+/gi.test(t)&&(s=f?f.getDay()-1:0)<0&&(s=6);var l="";return f&&(l=f.getHours()>=12?"pm":"am"),{year:0,month:0,day:s,date:n,h:i,m:a,s:o,f:u,t:l}}function j(e,t){return{"Y+|y+":{Y:""+Number((""+t.year).slice(-2)),YY:w((""+t.year).slice(-2),2),YYY:w((""+t.year).slice(-3),3),def:function(e){return w(""+t.year,e.length)}},"M+":{M:t.month+1,MM:w(""+(t.month+1),2),MMM:e.locale_months_abbr[t.month],def:e.locale_months[t.month]},"W+|w+":{W:t.day,WW:w(""+t.day,2),WWW:e.locale_days_abbr[t.day],def:e.locale_days[t.day]},"D+|d+":{D:t.date,def:function(e){return w(""+t.date,e.length)}},"h+|H+":{h:t.h,def:function(e){return w(""+t.h,e.length)}},"m+":{m:t.m,def:function(e){return w(""+t.m,e.length)}},"s+|S+":{s:t.s,def:function(e){return w(""+t.s,e.length)}},"f+|F+":{def:function(e){var r=""+t.f,n=e.length-r.length;if(n>0)for(var i=0;i<n;i++)r+="0";else n<0&&(r=r.slice(0,e.length));return r}},"t{1,2}|T{1,2}":{def:function(e){var r=t.t;return e[0].toUpperCase()===e[0]&&(r=r.toUpperCase()),r=r.slice(0,e.length)}}}}function V(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return new(Function.prototype.bind.apply(Ae,[null].concat(t)))}function R(e){return new Date(1899,11,30+Math.floor(e),0,0,0,864e5*(e-Math.floor(e)))}function Y(e){function t(e){return n!==Ee.INTERVAL?R(e):e}function r(e){return e=t(e),i.format(e)}var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"TS",i=V(arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,e,n);return r.format=function(e,r){return r=t(r),i.format(r,e)},r.locale=function(t){return i=V(t,e,n),this},r.qtype=function(e){return void 0!==e&&(n=e),n},r}function z(e,t){if(e&&e.qNumFormat&&-1!==["D","T","TS","IV"].indexOf(e.qNumFormat.qType))return Y(e.qNumFormat.qFmt,e.qNumFormat.qType,t);var r="#",n=t&&void 0!==t.qThousandSep?t.qThousandSep:",",i=t&&void 0!==t.qDecimalSep?t.qDecimalSep:".",a="U",o=e&&!!e.qIsAutoFormat;return e&&e.qNumFormat&&(r=e.qNumFormat.qFmt||r,n=e.qNumFormat.qThou||n,i=e.qNumFormat.qDec||i,a=e.qNumFormat.qType||a,o=o&&-1===["M"].indexOf(e.qNumFormat.qType)),o&&(r="#"+i+"##A",a="U"),N(r,n,i,a,t)}function _(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.meta,r=e.id,n=e.key,i=e.cube,a=e.localeInfo,o=e.fieldExtractor,u=void 0,s="qStateCounts"in t||"qSize"in t?"dimension":"measure",f="dimension"===s?Ie(i):Ce(i),l="dimension"===s?"first":"avg",c=z(t,a),p={id:function(){return r},key:function(){return n},title:function(){return t.qFallbackTitle||t.label},type:function(){return s},items:function(){return u||(u=o(p)),u},min:function(){return t.qMin},max:function(){return t.qMax},value:f,label:function(e){return e.qText},reduce:l,formatter:function(){return c},tags:function(){return t.qTags}};return p}function P(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],r=arguments[2],n=arguments[3];return"K"===!t.raw().qMode?null:p(e,t,r,n)}function L(e,t,r,n){var i=t.raw();return"K"===i.qMode?g(e,t,r,n):"S"===i.qMode?x(e,t,r,n):[]}function B(e,t,r){var n=r.cache,i=r.cube,a=r.pages,o=r.fieldExtractor,u=r.key,s=r.fieldKey;t.qAttrDimInfo&&(n.attributeDimensionFields[e]=t.qAttrDimInfo.map(function(e,t){return e?_({meta:e,id:u+"/"+s+"/qAttrDimInfo/"+t,key:s+"/qAttrDimInfo/"+t,cube:i,pages:a,fieldExtractor:o}):void 0})),t.qAttrExprInfo&&(n.attributeExpressionFields[e]=t.qAttrExprInfo.map(function(e,t){return e?_({meta:e,id:u+"/"+s+"/qAttrExprInfo/"+t,key:s+"/qAttrExprInfo/"+t,cube:i,pages:a,fieldExtractor:o}):void 0}))}function U(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.key,r={attributeDimensionFields:[],attributeExpressionFields:[],fields:[]},n=e.data;if(!n.qDimensionInfo)throw new Error("The data input is not recognized as a hypercube");var i="K"===n.qMode?n.qStackedDataPages:n.qDataPages,a={normalizeConfig:U.normalizeProperties},o={key:function(){return t},raw:function(){return n},field:function(e){return v(e,{cache:r,cube:n,pages:i})},fields:function(){return r.fields.slice()},extract:function(e){return L(e,o,r,a)},hierarchy:function(e){return P(e,o,r,a)}},u=void 0;u="K"===n.qMode?function(e){return g({field:e},o,r,a)}:"S"===n.qMode?function(e){return x({field:e},o,r,a)}:function(){return[]};var s=n.qDimensionInfo;return s.forEach(function(e,a){var o="qDimensionInfo/"+a;r.fields.push(_({meta:e,id:t+"/"+o,key:o,cube:n,pages:i,fieldExtractor:u})),B(a,e,{cache:r,cube:n,pages:i,fieldExtractor:u,key:t,fieldKey:o})}),n.qMeasureInfo.forEach(function(e,a){var o="qMeasureInfo/"+a;r.fields.push(_({meta:e,id:t+"/"+o,key:o,cube:n,pages:i,fieldExtractor:u})),B(s.length+a,e,{cache:r,cube:n,pages:i,fieldExtractor:u,key:t,fieldKey:o})}),o}function W(e,t){var r=!1,n=0,i=e,a=""+i.substr(0,i.indexOf("qHyperCube")+10),o=!0;if(Se.test(e)){n=+Se.exec(e)[1];var s=e.replace(Se,"");if(r=!0,we.test(s)){n=0;var f=+we.exec(i)[2];isNaN(f)||(n=f,i=i.replace(/\/\d+$/,"")),o=!1}else if(Oe.test(s)){var l=0;if(t){var c=u(a,t);l+=c.qMeasureInfo.length,l=c.qDimensionInfo.slice(0,n).reduce(function(e,t){return e+t.qAttrExprInfo.length},l),n=l+=+Oe.exec(i)[1],r=!1}}}else if(Ne.test(e)){n=+Ne.exec(e)[1],r=!1;var p=e.replace(Ne,"");if(we.test(p)){n=0;var d=+we.exec(i)[2];isNaN(d)||(n=d,i=i.replace(/\/\d+$/,"")),o=!1,r=!0}else if(Oe.test(p)){var h=0;if(t){var v=u(a,t);h+=v.qMeasureInfo.length,h=v.qDimensionInfo.reduce(function(e,t){return e+t.qAttrExprInfo.length},h),h=v.qMeasureInfo.slice(0,n).reduce(function(e,t){return e+t.qAttrExprInfo.length},h),n=h+=+Oe.exec(i)[1]}}}return Fe.forEach(function(e){var t=Q(e,2),r=t[0],n=t[1];i=i.replace(r,n)}),o&&(i=""+i.substr(0,i.indexOf("/qHyperCubeDef")+14)),i&&"/"!==i[0]&&(i="/"+i),{index:n,path:i,type:r?"dimension":"measure"}}function $(e){U.normalizeProperties=e.data("default").normalizeProperties,e.data("q",U)}o.prototype=r.prototype={constructor:o,count:function(){return this.eachAfter(e)},each:function(e){var t,r,n,i,a=this,o=[a];do{for(t=o.reverse(),o=[];a=t.pop();)if(e(a),r=a.children)for(n=0,i=r.length;n<i;++n)o.push(r[n])}while(o.length);return this},eachAfter:function(e){for(var t,r,n,i=this,a=[i],o=[];i=a.pop();)if(o.push(i),t=i.children)for(r=0,n=t.length;r<n;++r)a.push(t[r]);for(;i=o.pop();)e(i);return this},eachBefore:function(e){for(var t,r,n=this,i=[n];n=i.pop();)if(e(n),t=n.children)for(r=t.length-1;r>=0;--r)i.push(t[r]);return this},sum:function(e){return this.eachAfter(function(t){for(var r=+e(t.data)||0,n=t.children,i=n&&n.length;--i>=0;)r+=n[i].value;t.value=r})},sort:function(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})},path:function(e){for(var r=this,n=t(r,e),i=[r];r!==n;)r=r.parent,i.push(r);for(var a=i.length;e!==n;)i.splice(a,0,e),e=e.parent;return i},ancestors:function(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t},descendants:function(){var e=[];return this.each(function(t){e.push(t)}),e},leaves:function(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e},links:function(){var e=this,t=[];return e.each(function(r){r!==e&&t.push({source:r.parent,target:r})}),t},copy:function(){return r(this).eachBefore(i)}};(function(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}).prototype=Object.create(o.prototype);var K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},J=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},X=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),G=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},Q=function(){function e(e,t){var r=[],n=!0,i=!1,a=void 0;try{for(var o,u=e[Symbol.iterator]();!(n=(o=u.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,a=e}finally{try{!n&&u.return&&u.return()}finally{if(i)throw a}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),Z=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},ee=/^qDimensionInfo(?:\/(\d+))?/,te=/^qMeasureInfo\/(\d+)/,re=/\/qAttrExprInfo\/(\d+)/,ne=/\/qAttrDimInfo\/(\d+)/,ie=Object.prototype.hasOwnProperty,ae=Object.prototype.toString,oe=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===ae.call(e)},ue=function(e){if(!e||"[object Object]"!==ae.call(e))return!1;var t=ie.call(e,"constructor"),r=e.constructor&&e.constructor.prototype&&ie.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!t&&!r)return!1;var n;for(n in e);return void 0===n||ie.call(e,n)},se=function e(){var t,r,n,i,a,o,u=arguments[0],s=1,f=arguments.length,l=!1;for("boolean"==typeof u&&(l=u,u=arguments[1]||{},s=2),(null==u||"object"!=typeof u&&"function"!=typeof u)&&(u={});s<f;++s)if(null!=(t=arguments[s]))for(r in t)n=u[r],u!==(i=t[r])&&(l&&i&&(ue(i)||(a=oe(i)))?(a?(a=!1,o=n&&oe(n)?n:[]):o=n&&ue(n)?n:{},u[r]=e(l,o,i)):void 0!==i&&(u[r]=i));return u},fe=("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self,function(e,t){return t={exports:{}},e(t,t.exports),t.exports}(function(e){!function(t,r){e.exports=r()}(0,function(){return function(e,t){if(!e||isNaN(+t))return t;var r,n,i,a,o,u,s,f,l,c,p=e.length,d=e.search(/[0-9\-\+#]/),h=d>0?e.substring(0,d):"",v=e.split("").reverse().join(""),m=v.search(/[0-9\-\+#]/),y=p-m,g=e.substring(y,y+1),b=y+("."===g||","===g?1:0),q=m>0?e.substring(b,p):"";if(e=e.substring(d,b),t="-"===e.charAt(0)?-t:+t,r=t<0?t=-t:0,n=e.match(/[^\d\-\+#]/g),i=n&&n[n.length-1]||".",a=n&&n[1]&&n[0]||",",e=e.split(i),t=t.toFixed(e[1]&&e[1].length),t=+t+"",u=e[1]&&e[1].lastIndexOf("0"),(!(f=t.split("."))[1]||f[1]&&f[1].length<=u)&&(t=(+t).toFixed(u+1)),l=e[0].split(a),e[0]=l.join(""),(o=e[0]&&e[0].indexOf("0"))>-1)for(;f[0].length<e[0].length-o;)f[0]="0"+f[0];else 0==+f[0]&&(f[0]="");if(t=t.split("."),t[0]=f[0],s=l[1]&&l[l.length-1].length){for(v="",y=(c=t[0]).length%s,p=c.length,b=0;b<p;b++)v+=c.charAt(b),!((b-y+1)%s)&&b<p-s&&(v+=a);t[0]=v}return t[1]=e[1]&&t[1]?i+t[1]:"","0"!==(n=t.join(""))&&""!==n||(r=!1),h+(r?"-":"")+n+q}})})),le={3:"k",6:"M",9:"G",12:"T",15:"P",18:"E",21:"Z",24:"Y","-3":"m","-6":"μ","-9":"n","-12":"p","-15":"f","-18":"a","-21":"z","-24":"y"},ce=/%$/,pe=/^\(r(0[2-9]|[12]\d|3[0-6])\)/i,de=/^\(oct\)/i,he=/^\(dec\)/i,ve=/^\(hex\)/i,me=/^\(bin\)/i,ye=/^\(rom\)/i,ge=/^(\(rom\)|\(bin\)|\(hex\)|\(dec\)|\(oct\)|\(r(0[2-9]|[12]\d|3[0-6])\))/i,be=function(){function e(t,r,n,i,a){J(this,e),this.localeInfo=t,this.pattern=r,this.thousandDelimiter=n||",",this.decimalDelimiter=i||".",this.type=a||"numeric",this.prepare()}return X(e,[{key:"clone",value:function(){var t=new e(this.localeInfo,this.pattern,this.thousandDelimiter,this.decimalDelimiter,this.type);return t.subtype=this.subtype,t}},{key:"format",value:function(e,t,r,n){return this.prepare(t,r,n),this.formatValue(e)}},{key:"prepare",value:function(e,t,r){var n=void 0;if(void 0===e&&(e=this.pattern),void 0===t&&(t=this.thousandDelimiter),void 0===r&&(r=this.decimalDelimiter),e){this._prepared={positive:{d:r,t:t,abbreviate:!1,isFunctional:!1,prefix:"",postfix:""},negative:{d:r,t:t,abbreviate:!1,isFunctional:!1,prefix:"",postfix:""},zero:{d:r,t:t,abbreviate:!1,isFunctional:!1,prefix:"",postfix:""}},n=this._prepared;e=e.split(";"),n.positive.pattern=e[0],n.negative.pattern=e[1],n.zero.pattern=e[2],ge.test(e[0])&&(n.positive.isFunctional=!0),e[1]?ge.test(e[1])&&(n.negative.isFunctional=!0):n.negative=!1,e[2]?ge.test(e[2])&&(n.zero.isFunctional=!0):n.zero=!1,n.positive.isFunctional||F(n.positive,t,r),n.negative&&!n.negative.isFunctional&&F(n.negative,t,r),n.zero&&!n.zero.isFunctional&&F(n.zero,t,r)}else this._prepared={pattern:!1}}},{key:"formatValue",value:function(e){var t=this._prepared,r=void 0,n=void 0,i="",a=void 0,o=void 0,u="",s=void 0,f=void 0,l=void 0,c=void 0,p=void 0,d=e;if(isNaN(e))return""+d;if(e=+e,!1===t.pattern)return e.toString();if(0===e&&t.zero)return(t=t.zero).pattern;if(e<0&&t.negative?(t=t.negative,e=-e):t=t.positive,s=t.d,f=t.t,t.isFunctional)e=E(e,t.pattern,s);else{if(t.percentage&&(e*=100),t.abbreviate&&(n=Number(Number(e).toExponential().split("e")[1]),(n-=n%3)in le&&(i=le[n],e/=Math.pow(10,n))),a=Math.abs(e),r=t.temp,c=t.numericPattern,p=c.split(s)[1],"I"===this.type&&(e=Math.round(e)),o=e,p||"#"!==c.slice(-1)[0])if(a>=1e15||a>0&&a<=1e-14)e=a?a.toExponential(15).replace(/\.?0+(?=e)/,""):"0";else{var h=Number(e.toFixed(Math.min(20,p?p.length:0)).split(".")[0]),v=c.split(s)[0];if(v+=s,e=fe(v,h)||"0",p){var m=Math.max(0,Math.min(14,p.length)),y=p.replace(/#+$/,"").length,g=("I"===this.type?0:a%1).toFixed(m).slice(2).replace(/0+$/,"");for(l=g.length;l<y;l++)g+="0";g&&(e+=s+g)}else 0===h&&(o=0)}else if(a>=Math.pow(10,r)||a<1||a<1e-4)0===e?e="0":a<1e-4||a>=1e20?(e=(e=o.toExponential(Math.max(1,Math.min(14,r))-1)).replace(/\.?0+(?=e)/,""),u=""):(e=e.toPrecision(Math.max(1,Math.min(14,r)))).indexOf(".")>=0&&(e=(e=e.replace(e.indexOf("e")<0?/0+$/:/\.?0+(?=e)/,"")).replace(".",s));else{for(c+=s,r=Math.max(0,Math.min(20,r-Math.ceil(Math.log(a)/Math.log(10)))),l=0;l<r;l++)c+="#";e=fe(c,e)}e=e.replace(t.numericRegex,function(e){return e===f?t.groupTemp:e===s?t.decTemp:""}),o<0&&!/^-/.test(e)&&(e="-"+e)}return t.prefix+e+u+i+t.postfix}}],[{key:"getStaticFormatter",value:function(){return{prepare:function(){},formatValue:function(e){return""+e}}}}]),e}(),qe=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],xe=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],Me=["January","February","March","April","May","June","July","August","September","October","November","December"],De=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Ae=function(){function e(t,r,n){J(this,e);var i=t||{};if(i.qCalendarStrings||(i.qCalendarStrings={qLongDayNames:qe,qDayNames:xe,qLongMonthNames:Me,qMonthNames:De}),this.localeInfo=i,this.locale_days=i.qCalendarStrings.qLongDayNames.slice(),this.locale_days_abbr=i.qCalendarStrings.qDayNames.slice(),this.locale_months=i.qCalendarStrings.qLongMonthNames.slice(),this.locale_months_abbr=i.qCalendarStrings.qMonthNames.slice(),!r){var a;r=(a={},G(a,Ee.TIME,i.qTimeFmt||"hh:mm:ss"),G(a,Ee.DATE,i.qDateFmt||"YYYY-MM-DD"),G(a,Ee.DATE_TIME,i.qTimestampFmt||"YYYY-MM-DD hh:mm:ss"),a)[n]}this.pattern=r}return X(e,[{key:"clone",value:function(){var t=new e(this.localeInfo,this.pattern);return t.subtype=this.subtype,t}},{key:"format",value:function(e,t){t||(t=this.pattern?this.pattern:"YYYY-MM-DD hh:mm:ss"),t=t.replace(/\[.+]|\[|]/g,"");var r=/t+/gi.test(t),n=void 0,i=j(this,n=e instanceof Date?O(e,r):H(e,t)),a=[];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&a.push(o);var u=new RegExp(a.join("|"),"g");return t.replace(u,function(e){var t=void 0,r=void 0;for(r in i)if(Object.prototype.hasOwnProperty.call(i,r)&&(t=new RegExp(r)).test(e))break;if(!t)return"";var n=void 0;for(var a in i[r])if(a===e||a.toLowerCase()===e){void 0===(n=i[r][a])&&(n=i[r][a.toLowerCase()]);break}return void 0===n&&(n=i[r].def),"function"==typeof n&&(n=n(e)),n})}}]),e}(),Ee={AUTO:"U",INTEGER:"I",NUMBER:"R",FIXED_TO:"F",MONEY:"M",DATE:"D",TIME:"T",DATE_TIME:"TS",INTERVAL:"IV"},Ie=function(e){return"S"===e.qMode?function(e){return e.qElemNumber}:function(e){return e.qElemNo}},Ce=function(e){return"S"===e.qMode?function(e){return e.qNum}:function(e){return e.qValue}},Fe=[["qHyperCube","qHyperCubeDef"],["qDimensionInfo","qDimensions"],["qMeasureInfo","qMeasures"],["qAttrDimInfo","qAttributeDimensions"],["qAttrExprInfo","qAttributeExpressions"]],Se=/\/qDimensionInfo(?:\/(\d+))?/,Ne=/\/qMeasureInfo\/(\d+)/,we=/\/qAttrDimInfo\/(\d+)(?:\/(\d+))?/,Oe=/\/qAttrExprInfo\/(\d+)/;return $.qBrushHelper=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments[2],n=t.byCells,i=t.primarySource,a=[],o={},u=e.isActive(),s=!1;return e.brushes().forEach(function(e){var t=W(e.id,r);if("range"===e.type&&"measure"===t.type){var u=e.brush.ranges();u.length&&(s=!0,o.rangeSelectHyperCubeValues||(o.rangeSelectHyperCubeValues={path:t.path,ranges:[]}),u.forEach(function(e){return o.rangeSelectHyperCubeValues.ranges.push({qMeasureIx:t.index,qRange:{qMin:e.min,qMax:e.max,qMinInclEq:!0,qMaxInclEq:!0}})}))}if("range"===e.type&&"dimension"===t.type){var f=e.brush.ranges();f.length&&(s=!0,o.selectHyperCubeContinuousRange||(o.selectHyperCubeContinuousRange={path:t.path,ranges:[]}),f.forEach(function(e){return o.selectHyperCubeContinuousRange.ranges.push({qDimIx:t.index,qRange:{qMin:e.min,qMax:e.max,qMinInclEq:!0,qMaxInclEq:!1}})}))}if("value"===e.type&&"dimension"===t.type)if(n)o.selectHyperCubeCells||(o.selectHyperCubeCells={path:t.path,cols:[]}),o.selectHyperCubeCells.cols.push(t.index),e.id!==i&&(i||o.selectHyperCubeCells.values)||(o.selectHyperCubeCells.values=e.brush.values().map(function(e){return+e}).filter(function(e){return!isNaN(e)}),s=!!o.selectHyperCubeCells.values.length);else{var l=e.brush.values().map(function(e){return+e}).filter(function(e){return!isNaN(e)});s=!!l.length,a.push({params:[t.path,t.index,l,!1],method:"selectHyperCubeValues"})}}),!s&&u?[{method:"resetMadeSelections",params:[]}]:(o.rangeSelectHyperCubeValues&&a.push({method:"rangeSelectHyperCubeValues",params:[o.rangeSelectHyperCubeValues.path,o.rangeSelectHyperCubeValues.ranges,[],!0]}),o.selectHyperCubeContinuousRange&&a.push({method:"selectHyperCubeContinuousRange",params:[o.selectHyperCubeContinuousRange.path,o.selectHyperCubeContinuousRange.ranges]}),o.selectHyperCubeCells&&a.push({method:"selectHyperCubeCells",params:[o.selectHyperCubeCells.path,o.selectHyperCubeCells.values,o.selectHyperCubeCells.cols]}),a)},$});
